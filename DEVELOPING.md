# DEVELOPING

## Todo

- [x] <del>添加 Coinbase 交易结构，并且放入到区块头中，在打包区块的同时放入到交易头<del>
- [x] <del>设计区块同步算法</del>
- [ ] 对协程添加 context，保证对每个协程可控
- [ ] 重构代码，在完成基本功能后进行代码结构的优化
- [ ] 对测试代码进行优化，目前的测试代码在进行交易的发送时无法进行区块的同步
- [x] 时间同步算法的设计，对区块进行时间上的校验
- [x] 加入 VDF 生成算法用于选取节点（前置依赖，VRF 的生成用于验证打包节点）
- [x] VRF 算法的实现
- [x] VDF 与 VRF 结合完成共识算法
- [ ] VRF 代码优化，对编码等数据结构的统一
- [ ] 交易在内存中的索引方式，所需要的数据结构的设计和实现
- [ ] RPC接口的实现，需要仿照 Ethereum 的接口设计来完成对应的接口
- [ ] 账户的模型应该是什么样子的，如何在数据库中存储，以及如何导入到内存中，在内存中如何管理？
- [x] 时间共识算法如何嵌入到共识过程中，分布式下的时间共识的实现？
- [ ] 序列化和反序列化通过泛型或者其他方式来整合接口？

## 安全问题

* VDF 在缓冲区处理过程中，恶意的敌手可以选取大量的私钥通过VRF计算该私钥是否可以完成一个节点的打包，如何/是否需要避免这样的攻击？这样会抢夺正常的区块打包权。

## 开发日志

### v1.0.0

#### 2023.07.11 - 27

* 多节点测试缓冲区出存在问题
* 修复缓冲区存在的问题
  1. 原有设计的内存优化方案在实现后存在问题，多次标记后导致区块失效，使得多个节点下的缓冲区视图存在问题
  2. P2P 连接下在交易过多的情况下会阻塞发送队列，导致区块拉取存在延迟，进一步导致各个节点下的视图不一致

#### 2023.06.20 - 30

* 添加了时间共识算法
* 添加了 prometheus + grafana 进行指标监控

#### 2023.06.19 - 20

* 添加了 RPC 接口便于进行压力测试（submitTransaction）
* 修复配置文件路径问题，一个常见的问题：修改了配置文件格式但是路径没有进行修改

#### 2023.05.24-25

* 添加了VRF的验证过程，通过读取配置文件中的节点私钥来进行计算
* 定义了简单的配置文件信息
* 将 VRF 的验证过程添加到了区块打包前，并且加入了 VDF 的计算过程中

#### 2023.05.14

* 区块头添加两种参数：创世区块中的VDF计算参数和其他区块中的VRF验证参数
* 添加了部分共识逻辑，目前未完成所有代码逻辑

待解决的问题：
* 配置文件格式的定义和对应代码的实现：便于初始化节点程序的相关信息
* VRF 通过输入 VDF 的信息后进行验证的过程，需要验证节点可以进行区块的打包

#### 2023.04.11 

* 完成了区块同步代码的测试和修复